<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>학생 성적 리포트</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background-color: #f4f6f8;
      padding: 20px;
      line-height: 1.6;
    }

    h1 {
      text-align: center;
      color: #333;
    }

    .student-box {
      background-color: #fff;
      border: 1px solid #ccc;
      border-radius: 10px;
      margin: 30px auto;
      padding: 20px;
      max-width: 800px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
    }

    .student-box h2 {
      text-align: center;
      color: #555;
      margin-bottom: 15px;
    }

    .tables-wrapper {
      display: flex;
      gap: 0; /* 간격 제거 */
      justify-content: center;
      flex-wrap: wrap;
    }

    table {
      width: 300px;
      border-collapse: collapse;
      margin: 0 5px;
    }

    th, td {
      padding: 10px;
      text-align: center;
      border: 1px solid #ddd;
    }

    th {
      background-color: #28a745;
      color: white;
    }

    td {
      background-color: #fff;
    }

    .average-row {
      background-color: #f1f1f1;
      font-weight: bold;
    }

    .no-records {
      text-align: center;
      font-size: 18px;
      color: #d9534f;
      margin-top: 50px;
    }
  </style>
</head>
<body>

  <h1>학생 성적 리포트</h1>
  <div id="results-container"></div>

  <script>
    window.onload = function () {
      const scores = JSON.parse(localStorage.getItem("studentScores")) || [];
      const container = document.getElementById("results-container");

      if (!Array.isArray(scores) || scores.length === 0) {
        container.innerHTML = "<p class='no-records'>저장된 성적이 없습니다.</p>";
        return;
      }

      scores.sort((a, b) => a.name.localeCompare(b.name, 'ko'));

      let content = "";

      scores.forEach(student => {
        const { name, records } = student;
        if (!records || records.length === 0) return;

        let total = 0;
        let scoreTable = `
          <table>
            <thead><tr><th>점수</th></tr></thead>
            <tbody>
        `;
        let dateTable = `
          <table>
            <thead><tr><th>시험 날짜</th></tr></thead>
            <tbody>
        `;

        records.forEach(r => {
          const dateOnly = new Date(r.date).toLocaleDateString("ko-KR", {
            year: 'numeric',
            month: '2-digit',
            day: '2-digit'
          }).replace(/\./g, '-').replace(/\s/g, '');

          scoreTable += `<tr><td>${r.score}점</td></tr>`;
          dateTable += `<tr><td>${dateOnly}</td></tr>`;
          total += r.score;
        });

        const avg = Math.round(total / records.length);
        scoreTable += `<tr class="average-row"><td>평균: ${avg}점</td></tr>`;

        scoreTable += "</tbody></table>";
        dateTable += "</tbody></table>";

        content += `
          <div class="student-box">
            <h2>${name}</h2>
            <div class="tables-wrapper">
              ${scoreTable}
              ${dateTable}
            </div>
          </div>
        `;
      });

      container.innerHTML = content;
    };
  </script>

</body>
</html>
